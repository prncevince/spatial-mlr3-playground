<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>A Spatial Statistics Playground w/ mlr3</title>

<script src="libs/header-attrs-2.14/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/chunk-names-1.0/chunk-names.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" data-external="1" defer integrity="sha256-bgI9WhLOPSUlPrdgHUg3rPIB2vq+D+mYkUTM3q0U8fw=" crossorigin="anonymous"></script>
<script>document.addEventListener("DOMContentLoaded", function () {
  var mathElements = document.getElementsByClassName("math");
  var macros = [];
  for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
      katex.render(texText.data, mathElements[i], {
        displayMode: mathElements[i].classList.contains("display"),
        throwOnError: false,
        macros: macros,
        fleqn: false
      });
    }}});
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" data-external="1">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="assets/style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">A Spatial Statistics Playground w/ mlr3</h1>

</div>


<div id="foreward" class="section level2 hasAnchor">
<h2 class="hasAnchor">Foreward<a href="#foreward" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here I explore handling spatial data to build predictive models. And in particularly I use the <a href="https://mlr3.mlr-org.com">mlr3</a> ecosystem as my modeling framework. Much of this code comes from the <a href="#resources">Resources</a> gathered below.</p>
<p>All of the computations are ran via GitHub Actions. Thus, the <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources">hardware / compute specs</a> are minimal - but the workflow to render this R Markdown is entirely reproducible.</p>
<p>Enjoy.</p>
</div>
<div id="setup" class="section level2 hasAnchor">
<h2 class="hasAnchor">Setup<a href="#setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="_packages_" class="chunk section level6">
<h6 class="hasAnchor">
packages<a href="#_packages_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code># from pca-mlr3-pipelines
library(mlr3verse)
library(data.table)
library(future)
library(igraph)
library(ggfortify)
library(scattermore)
library(R6)
library(rlang)
# from Statistical Learning | Geocomputation with R
library(lgr)
library(sf)
library(terra)
library(progressr)
library(mlr3spatiotempcv)
library(spDataLarge)
library(tmap)
library(tmaptools)
library(raster)
library(pROC)
library(tictoc)
library(ggplot2)
library(mlr3extralearners)</code></pre>
</div>
<div id="_mlr3verse_info_" class="chunk section level6">
<h6 class="hasAnchor">
mlr3verse_info<a href="#_mlr3verse_info_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>mlr3verse_info()</code></pre>
<pre><code>##              package version
##  1:            bbotk   0.5.1
##  2:      mlr3cluster   0.1.2
##  3:         mlr3data   0.6.0
##  4:      mlr3filters   0.5.0
##  5:      mlr3fselect   0.6.1
##  6:    mlr3hyperband   0.4.0
##  7:     mlr3learners   0.5.2
##  8:         mlr3misc  0.10.0
##  9:    mlr3pipelines   0.4.0
## 10:        mlr3proba   0.4.4
## 11:       mlr3tuning  0.12.1
## 12: mlr3tuningspaces   0.1.1
## 13:          mlr3viz   0.5.9
## 14:          paradox   0.8.0</code></pre>
</div>
</div>
<div id="resources" class="section level2 hasAnchor">
<h2 class="hasAnchor">Resources<a href="#resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="https://geocompr.robinlovelace.net">Geocomputing with R</a>
<ul>
<li><a href="https://geocompr.robinlovelace.net/spatial-cv.html">Chapter 12 Statistical learning</a>
<ul>
<li><a href="https://github.com/Robinlovelace/geocompr/blob/main/12-spatial-cv.Rmd" class="uri">https://github.com/Robinlovelace/geocompr/blob/main/12-spatial-cv.Rmd</a></li>
<li><a href="https://github.com/Robinlovelace/geocompr/blob/main/code/12-cv.R" class="uri">https://github.com/Robinlovelace/geocompr/blob/main/code/12-cv.R</a></li>
</ul></li>
</ul></li>
<li><a href="https://mlr3book.mlr-org.com/special-tasks.html#spatiotemporal">Chapter 8.3 Spatiotemporal Analysis | mlr3 Book</a></li>
<li><a href="https://mlr.mlr-org.com/articles/tutorial/handling_of_spatial_data.html">Handling of Spatial Data | mlr v2 articles</a></li>
<li><a href="https://keen-swartz-3146c4.netlify.app">Spatial Data Science</a>
<ul>
<li><a href="https://keen-swartz-3146c4.netlify.app/interpolation.html">Chapter 12 Spatial Interpolation</a></li>
<li><a href="https://keen-swartz-3146c4.netlify.app/spatglmm.html">Chapter 16 Spatial Regression</a></li>
</ul></li>
</ul>
</div>
<div id="landslide-susceptibility" class="section level2 hasAnchor">
<h2 class="hasAnchor">Landslide Susceptibility<a href="#landslide-susceptibility" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="data" class="section level3 hasAnchor">
<h3 class="hasAnchor">Data<a href="#data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="_data_" class="chunk section level6">
<h6 class="hasAnchor">
data<a href="#_data_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>data(&quot;lsl&quot;, &quot;study_mask&quot;, package = &quot;spDataLarge&quot;)
lsl &lt;- as.data.table(lsl)
ta &lt;- terra::rast(system.file(&quot;raster/ta.tif&quot;, package = &quot;spDataLarge&quot;))</code></pre>
</div>
<div id="_map-landslides_" class="chunk section level6">
<h6 class="hasAnchor">
map-landslides<a href="#_map-landslides_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>lsl_sf &lt;- st_as_sf(lsl, coords = c(&quot;x&quot;, &quot;y&quot;), crs = &quot;EPSG:32717&quot;)

# terra generates errors if this object is called named &#39;slope&#39;
slope1 &lt;- ta$slope * pi / 180
aspect &lt;- terra::terrain(ta$elev, v = &quot;aspect&quot;, unit = &quot;radians&quot;)
hs &lt;- terra::shade(slope = slope1, aspect = aspect)
# so far tmaptools does not support terra objects
bbx &lt;- tmaptools::bb(
  raster::raster(hs), xlim = c(-0.0001, 1),
  ylim = c(-0.0001, 1), relative = TRUE
)

map &lt;- tm_shape(hs, bbox = bbx) +
  tm_grid(
    col = &quot;black&quot;, n.x = 1, n.y = 1, labels.inside.frame = FALSE,
    labels.rot = c(0, 90), lines = FALSE
  ) +
  tm_raster(palette = gray(0:100 / 100), n = 100, legend.show = FALSE) +
  tm_shape(ta$elev) +
  tm_raster(alpha = 0.5, palette = terrain.colors(10), legend.show = FALSE) +
  tm_shape(lsl_sf) +
  tm_bubbles(
    &quot;lslpts&quot;, size = 0.2, palette = &quot;-RdYlBu&quot;, title.col = &quot;Landslide: &quot;
  ) +
  tm_layout(inner.margins = 0) +
  tm_legend(bg.color = &quot;white&quot;)</code></pre>
</div>
<div id="_map-landslides-fig_" class="chunk section level6">
<h6 class="hasAnchor">
map-landslides-fig<a href="#_map-landslides-fig_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<img src="assets/img/map-landslides-fig-1.png" width="672" />
</div>
<div id="_lsl_" class="chunk section level6">
<h6 class="hasAnchor">
lsl<a href="#_lsl_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>lsl</code></pre>
<pre><code>##             x       y lslpts    slope        cplan        cprof     elev
##   1: 713887.7 9558537  FALSE 33.75185  0.023180449  0.003193061 2422.810
##   2: 712787.7 9558917  FALSE 39.40821 -0.038638908 -0.017187813 2051.771
##   3: 713407.7 9560307  FALSE 37.45409 -0.013329108  0.009671087 1957.832
##   4: 714887.7 9560237  FALSE 31.49607  0.040931452  0.005888638 1968.621
##   5: 715247.7 9557117  FALSE 44.07456  0.009686948  0.005149810 3007.774
##  ---                                                                    
## 346: 714877.2 9558362   TRUE 49.16936 -0.079123855 -0.004267062 2577.096
## 347: 714909.5 9558581   TRUE 39.75526 -0.022253942  0.010101856 2441.529
## 348: 713713.6 9558849   TRUE 41.92702 -0.026429312  0.001791014 2375.455
## 349: 715253.2 9558797   TRUE 38.98206 -0.035161112  0.002966748 2442.470
## 350: 713825.6 9559078   TRUE 35.21368  0.020333998 -0.003390223 2377.151
##      log10_carea
##   1:    2.784319
##   2:    4.146013
##   3:    3.643556
##   4:    2.268703
##   5:    3.003426
##  ---            
## 346:    3.242106
## 347:    3.037662
## 348:    2.859420
## 349:    2.735578
## 350:    3.203316</code></pre>
</div>
</div>
<div id="spatial-bias" class="section level3 hasAnchor">
<h3 class="hasAnchor">Spatial Bias<a href="#spatial-bias" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="glm-classif---predictive-model" class="section level4 hasAnchor">
<h4 class="hasAnchor">GLM Classif - Predictive Model<a href="#glm-classif---predictive-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="_glm-fit-pred_" class="chunk section level6">
<h6 class="hasAnchor">
glm-fit-pred<a href="#_glm-fit-pred_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>fit &lt;- glm(
  lslpts ~ slope + cplan + cprof + elev + log10_carea,
  family = binomial(),
  data = lsl
)

pred &lt;- terra::predict(ta, model = fit, type = &quot;response&quot;)</code></pre>
</div>
<div id="_map-landslides-glm-bias-pred_" class="chunk section level6">
<h6 class="hasAnchor">
map-landslides-glm-bias-pred<a href="#_map-landslides-glm-bias-pred_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>sv_study_mask &lt;- terra::vect(study_mask)

map_glm &lt;- tm_shape(hs, bbox = bbx) +
  tm_grid(
    col = &quot;black&quot;, n.x = 1, n.y = 1, labels.inside.frame = FALSE,
    labels.rot = c(0, 90), lines = FALSE
  ) +
  tm_raster(palette = &quot;white&quot;, legend.show = FALSE) +
  # hillshade
  tm_shape(terra::mask(hs, sv_study_mask), bbox = bbx) +
  tm_raster(palette = gray(0:100 / 100), n = 100, legend.show = FALSE) +
  # prediction raster
  tm_shape(terra::mask(pred, sv_study_mask)) +
  tm_raster(
    alpha = 0.5, palette = &quot;Reds&quot;, n = 6, legend.show = TRUE, title = &quot;Susceptibility&quot;
  ) +
  tm_layout(
    legend.position = c(&quot;left&quot;, &quot;bottom&quot;), legend.title.size = 0.9, inner.margins = 0
  )</code></pre>
</div>
<div id="_map-landslides-glm-bias-pred-fig_" class="chunk section level6">
<h6 class="hasAnchor">
map-landslides-glm-bias-pred-fig<a href="#_map-landslides-glm-bias-pred-fig_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<img src="assets/img/map-landslides-glm-bias-pred-fig-1.png" width="672" />
</div>
<div id="_auroc_" class="chunk section level6">
<h6 class="hasAnchor">
auroc<a href="#_auroc_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>pROC::auc(pROC::roc(lsl$lslpts, fitted(fit)))</code></pre>
<pre><code>## Area under the curve: 0.8216</code></pre>
</div>
</div>
</div>
<div id="spatial-cv-using-mlr3" class="section level3 hasAnchor">
<h3 class="hasAnchor">Spatial CV using mlr3<a href="#spatial-cv-using-mlr3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we introduce spatial cross validation to combat spatial autocorrelation and bias. As mentioned previously, we’ll use the <a href="https://mlr3.mlr-org.com">mlr3</a> framework to build our model.</p>
<p>Specifically, we’ll run 4 types of models. The first 2 will be specified via an mlr3 ‘design’. A design is a table of scenarios (models to be evaluated) of unique combinations of <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>, <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a>, and <a href="https://mlr3.mlr-org.com/reference/Resampling.html"><code>Resampling</code></a> objects.</p>
<p>We create the design using <code>benchmark_grid</code> and can run the design object using <code>benchmark</code>.</p>
<p>We will parallelize the execution of our models as much as possible. This depends on the number of cores that are available on our machine and by how we instruct <code>future</code>s to be resolved by specifying the <a href="https://future.futureverse.org/articles/future-3-topologies.html">future topology</a> via <code>future::plan</code>. An optimal approach can also depend on types of resampling methods used by each of our models (e.g. nested resampling can be executing in parallel in the inner resampling loop), as well as the dimensions of our design.</p>
<div id="glm-classif---model-evaluation" class="section level4 hasAnchor">
<h4 class="hasAnchor">GLM Classif - Model Evaluation<a href="#glm-classif---model-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The point of this section is to retrieve a bias-reduced performance estimate. We’ll do this by using the logistic regression learner “classif.log_reg” first for predicting landslide susceptibility.</p>
<p>In the next section, we will use a learner that has hyperparameters (an SVM), which we will tune. The goal of training that model will be to maximize predictive performance.</p>
<div id="task" class="section level5 hasAnchor">
<h5 class="hasAnchor">Task<a href="#task" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Note, both <code>TaskClassifST$new</code> &amp; <code>as_task_classif_st</code> can accept <code>sf</code> objects, e.g. our <code>lsl_sf</code> object. When this is the case, spatial metadata can be extracted and used for input arguments to the task (e.g. <code>coordinate_names</code> &amp; <code>crs</code> in the <code>extra_args</code> list).</p>
<p>However, apparently the task converts the <code>sf</code> object into a <code>data.table</code> object, which we know could become memory intensive when handling large data.</p>
<p>By default, all variables <em>other</em> than the <code>target</code> parameter &amp; the <code>coordinate_names</code> within the <code>backend</code>/<code>x</code> object are used as predictor variables. By default <code>coords_as_features</code> is set to <code>FALSE</code>, which instructs the task to not use <code>coordinate_names</code> as predictors. Set this to <code>TRUE</code> to use them as predictors.</p>
<div id="_task_new_" class="chunk section level6">
<h6 class="hasAnchor">
task_new<a href="#_task_new_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>task_new &lt;- mlr3spatiotempcv::TaskClassifST$new(
  id = &quot;lsl&quot;,
  backend = mlr3::as_data_backend(lsl), 
  target = &quot;lslpts&quot;, 
  positive = &quot;TRUE&quot;,
  extra_args = list(
    coordinate_names = c(&quot;x&quot;, &quot;y&quot;),
    coords_as_features = FALSE,
    crs = &quot;EPSG:32717&quot;
  )
)

task_new</code></pre>
<pre><code>## &lt;TaskClassifST:lsl&gt; (350 x 6)
## * Target: lslpts
## * Properties: twoclass
## * Features (5):
##   - dbl (5): cplan, cprof, elev, log10_carea, slope
## * Coordinates:
##             x       y
##   1: 713887.7 9558537
##   2: 712787.7 9558917
##   3: 713407.7 9560307
##   4: 714887.7 9560237
##   5: 715247.7 9557117
##  ---                 
## 346: 714877.2 9558362
## 347: 714909.5 9558581
## 348: 713713.6 9558849
## 349: 715253.2 9558797
## 350: 713825.6 9559078</code></pre>
</div>
<div id="_task_" class="chunk section level6">
<h6 class="hasAnchor">
task<a href="#_task_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>task &lt;- as_task_classif_st(
  x = lsl,
  target = &quot;lslpts&quot;,
  positive = &quot;TRUE&quot;,
  coordinate_names = c(&quot;x&quot;, &quot;y&quot;),
  coords_as_features = FALSE,
  crs = &quot;EPSG:32717&quot;
)

task</code></pre>
<pre><code>## &lt;TaskClassifST:lsl&gt; (350 x 6)
## * Target: lslpts
## * Properties: twoclass
## * Features (5):
##   - dbl (5): cplan, cprof, elev, log10_carea, slope
## * Coordinates:
##             x       y
##   1: 713887.7 9558537
##   2: 712787.7 9558917
##   3: 713407.7 9560307
##   4: 714887.7 9560237
##   5: 715247.7 9557117
##  ---                 
## 346: 714877.2 9558362
## 347: 714909.5 9558581
## 348: 713713.6 9558849
## 349: 715253.2 9558797
## 350: 713825.6 9559078</code></pre>
</div>
<p>Creating the tasks via the above methods seem to make them identical, but that’s not <strong><em>strictly</em></strong> the case.</p>
<pre class="r"><code>identical(task_new, task)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<div id="_plt_duo_" class="chunk section level6">
<h6 class="hasAnchor">
plt_duo<a href="#_plt_duo_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>mlr3viz::autoplot(task, type = &quot;duo&quot;)</code></pre>
<img src="assets/img/plt_duo-1.png" width="672" />
</div>
<div id="_plot_pairs_" class="chunk section level6">
<h6 class="hasAnchor">
plot_pairs<a href="#_plot_pairs_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>mlr3viz::autoplot(task, type = &quot;pairs&quot;)</code></pre>
<img src="assets/img/plot_pairs-1.png" width="3023" />
</div>
</div>
<div id="learner" class="section level5 hasAnchor">
<h5 class="hasAnchor">Learner<a href="#learner" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We’ll use a logistic regression learner for this task since the response variable of <code>lsl$lslpts</code> is binary.</p>
<pre class="r"><code>as.data.table(mlr_learners) %&gt;% `[`(key == &quot;classif.log_reg&quot;)</code></pre>
<pre><code>##                key label task_type                                    feature_types                packages              properties predict_types
## 1: classif.log_reg  &lt;NA&gt;   classif logical,integer,numeric,character,factor,ordered mlr3,mlr3learners,stats loglik,twoclass,weights response,prob</code></pre>
<pre class="r"><code>learner &lt;- lrn(&quot;classif.log_reg&quot;, predict_type = &quot;prob&quot;)
# to make sure that training does not stop b/c of any failing models, we define a fallback learner
learner$fallback &lt;- lrn(&quot;classif.featureless&quot;, predict_type = &quot;prob&quot;)</code></pre>
</div>
<div id="resampling" class="section level5 hasAnchor">
<h5 class="hasAnchor">Resampling<a href="#resampling" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>resamplings &lt;- list(
  rsmp(&quot;repeated_spcv_coords&quot;, folds = 5, repeats = 100),
  rsmp(&quot;repeated_cv&quot;, folds = 5, repeats = 100)
)</code></pre>
</div>
<div id="design-benchmark-grid" class="section level5 hasAnchor">
<h5 class="hasAnchor">Design &amp; Benchmark Grid<a href="#design-benchmark-grid" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>design &lt;- benchmark_grid(
  tasks = task,
  learners = learner,
  resamplings = resamplings
)

design</code></pre>
<pre><code>##                   task                    learner
## 1: &lt;TaskClassifST[51]&gt; &lt;LearnerClassifLogReg[37]&gt;
## 2: &lt;TaskClassifST[51]&gt; &lt;LearnerClassifLogReg[37]&gt;
##                            resampling
## 1: &lt;ResamplingRepeatedSpCVCoords[22]&gt;
## 2:         &lt;ResamplingRepeatedCV[22]&gt;</code></pre>
</div>
<div id="execution---training" class="section level5 hasAnchor">
<h5 class="hasAnchor">Execution - Training<a href="#execution---training" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Set seed for reproducibility.</p>
<pre class="r"><code>set.seed(1)

plan(multisession)</code></pre>
<pre class="r"><code>lgr::get_logger(&quot;mlr3&quot;)$set_threshold(&quot;warn&quot;)

tic()
progressr::with_progress(
  bmr &lt;- benchmark(
    design = design,
    store_models = FALSE,
    store_backends = FALSE,
    encapsulate = &quot;evaluate&quot;
  )
)
toc()</code></pre>
<pre><code>## 26.854 sec elapsed</code></pre>
</div>
<div id="model-performance-evaluation" class="section level5 hasAnchor">
<h5 class="hasAnchor">Model Performance Evaluation<a href="#model-performance-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>p_auroc &lt;- autoplot(bmr, measure = msr(&quot;classif.auc&quot;))
p_auroc$labels$y = &quot;AUROC&quot;
p_auroc$layers[[1]]$aes_params$fill = c(&quot;lightblue2&quot;, &quot;mistyrose2&quot;)

p_auroc + scale_x_discrete(labels=c(&quot;spatial CV&quot;, &quot;conventional CV&quot;))</code></pre>
<p><img src="assets/img/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>autoplot(bmr) + scale_x_discrete(labels=c(&quot;spatial CV&quot;, &quot;conventional CV&quot;))</code></pre>
<p><img src="assets/img/unnamed-chunk-9-1.png" width="672" /></p>
</div>
</div>
<div id="svm-classif---predictive-model" class="section level4 hasAnchor">
<h4 class="hasAnchor">SVM Classif - Predictive Model<a href="#svm-classif---predictive-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="learner-1" class="section level5 hasAnchor">
<h5 class="hasAnchor">Learner<a href="#learner-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>as.data.table(mlr_learners) %&gt;% `[`(grepl(&quot;svm&quot;, key) &amp; task_type == &quot;classif&quot;)</code></pre>
<pre><code>##              key label task_type                                    feature_types                       packages                  properties predict_types
## 1:  classif.ksvm  &lt;NA&gt;   classif logical,integer,numeric,character,factor,ordered mlr3,mlr3extralearners,kernlab multiclass,twoclass,weights response,prob
## 2: classif.lssvm  &lt;NA&gt;   classif                                  numeric,integer mlr3,mlr3extralearners,kernlab         multiclass,twoclass      response
## 3:   classif.svm  &lt;NA&gt;   classif                          logical,integer,numeric        mlr3,mlr3learners,e1071         multiclass,twoclass response,prob</code></pre>
<pre class="r"><code>lrn_ksvm &lt;- lrn(&quot;classif.ksvm&quot;, predict_type = &quot;prob&quot;, kernel = &quot;rbfdot&quot;, type = &quot;C-svc&quot;)
# to make sure that tuning does not stop b/c of any failing models, we define a fallback learner
lrn_ksvm$fallback &lt;- lrn(&quot;classif.featureless&quot;, predict_type = &quot;prob&quot;)</code></pre>
</div>
<div id="hyperparameter-tuner-strategy" class="section level5 hasAnchor">
<h5 class="hasAnchor">Hyperparameter Tuner Strategy<a href="#hyperparameter-tuner-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code># five spatially disjoint k-means partitions
tune_level_spcv &lt;- rsmp(&quot;spcv_coords&quot;, folds = 5)
# randomly sample partitions
tune_level_cv &lt;- rsmp(&quot;cv&quot;, folds = 5)
# use 50 randomly selected hyperparameters
terminator &lt;- trm(&quot;evals&quot;, n_evals = 50)
tuner &lt;- tnr(&quot;random_search&quot;)
# define the outer limits of the randomly selected hyperparameters
search_space &lt;- paradox::ps(
  C = paradox::p_dbl(lower = -12, upper = 15, trafo = function(x) 2^x),
  sigma = paradox::p_dbl(lower = -15, upper = 6, trafo = function(x) 2^x)
)</code></pre>
<pre class="r"><code>at_ksvm_spcv = mlr3tuning::AutoTuner$new(
  learner = lrn_ksvm,
  resampling = tune_level_spcv, # spatially disjoint k-fold k-means partitioning
  measure = mlr3::msr(&quot;classif.auc&quot;), # performance measure
  terminator = terminator, # n iterations of unique randomly selected hyperparameters
  tuner = tuner, # specify random search
  search_space = search_space, # predefined hyperparameter search space
  store_models = TRUE
)

at_ksvm_cv = mlr3tuning::AutoTuner$new(
  learner = lrn_ksvm,
  resampling = tune_level_cv,
  measure = mlr3::msr(&quot;classif.auc&quot;),
  terminator = terminator,
  tuner = tuner,
  search_space = search_space
)</code></pre>
</div>
<div id="execution---training-1" class="section level5 hasAnchor">
<h5 class="hasAnchor">Execution - Training<a href="#execution---training-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>set.seed(1)

plan(multisession)</code></pre>
<div id="_train-auto_" class="chunk section level6">
<h6 class="hasAnchor">
train-auto<a href="#_train-auto_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>lgr::get_logger(&quot;mlr3&quot;)$set_threshold(&quot;warn&quot;)
lgr::get_logger(&quot;bbotk&quot;)$set_threshold(&quot;warn&quot;)

tic()
progressr::with_progress(
  {
    at_ksvm_spcv$train(task = task)
    at_ksvm_cv$train(task)
  }
)
toc()</code></pre>
<pre><code>## 62.856 sec elapsed</code></pre>
</div>
<pre class="r"><code>at_ksvm_spcv$model$learner$state$model</code></pre>
<pre><code>## Support Vector Machine object of class &quot;ksvm&quot; 
## 
## SV type: C-svc  (classification) 
##  parameter : cost C = 18.917019252064 
## 
## Gaussian Radial Basis kernel function. 
##  Hyperparameter : sigma =  0.000987619014263272 
## 
## Number of Support Vectors : 251 
## 
## Objective Function Value : -4386.238 
## Training error : 0.245714 
## Probability model included.</code></pre>
<pre class="r"><code>at_ksvm_spcv$model$tuning_instance</code></pre>
<pre><code>## &lt;TuningInstanceSingleCrit&gt;
## * State:  Optimized
## * Objective: &lt;ObjectiveTuning:classif.ksvm_on_lsl&gt;
## * Search Space:
## &lt;ParamSet&gt;
##       id    class lower upper nlevels        default value
## 1:     C ParamDbl   -12    15     Inf &lt;NoDefault[3]&gt;      
## 2: sigma ParamDbl   -15     6     Inf &lt;NoDefault[3]&gt;      
## Trafo is set.
## * Terminator: &lt;TerminatorEvals&gt;
## * Terminated: TRUE
## * Result:
##           C     sigma learner_param_vals  x_domain classif.auc
## 1: 4.241613 -9.983758          &lt;list[4]&gt; &lt;list[2]&gt;   0.7817883
## * Archive:
## &lt;ArchiveTuning&gt;
##          C   sigma classif.auc runtime_learners              timestamp batch_nr warnings errors      resample_result
##  1: -10.33 -10.675        0.77             2.30 2022-06-06 09:50:41.36        1        0      0 &lt;ResampleResult[22]&gt;
##  2:  -1.63   1.167        0.73             0.26 2022-06-06 09:50:41.73        2        0      0 &lt;ResampleResult[22]&gt;
##  3:  14.78  -7.019        0.71             3.00 2022-06-06 09:50:43.80        3        0      0 &lt;ResampleResult[22]&gt;
##  4:  -6.27  -1.315        0.76             0.24 2022-06-06 09:50:44.25        4        0      0 &lt;ResampleResult[22]&gt;
##  5:  -1.57 -14.719        0.77             0.24 2022-06-06 09:50:44.84        5        0      0 &lt;ResampleResult[22]&gt;
##  6:  -2.81  -4.876        0.78             0.24 2022-06-06 09:50:45.33        6        0      0 &lt;ResampleResult[22]&gt;
##  7:  -6.97   2.375        0.69             0.27 2022-06-06 09:50:45.93        7        0      0 &lt;ResampleResult[22]&gt;
##  8:  -9.09   0.198        0.75             0.23 2022-06-06 09:50:46.53        8        0      0 &lt;ResampleResult[22]&gt;
##  9:   5.47   1.442        0.67             0.25 2022-06-06 09:50:47.12        9        0      0 &lt;ResampleResult[22]&gt;
## 10:   9.31 -14.510        0.78             0.22 2022-06-06 09:50:47.62       10        0      0 &lt;ResampleResult[22]&gt;
## 11:   6.70  -4.970        0.72             0.26 2022-06-06 09:50:48.23       11        0      0 &lt;ResampleResult[22]&gt;
## 12:  -5.39 -13.516        0.77             0.27 2022-06-06 09:50:48.83       12        0      0 &lt;ResampleResult[22]&gt;
## 13:   2.00  -1.098        0.75             0.22 2022-06-06 09:50:49.33       13        0      0 &lt;ResampleResult[22]&gt;
## 14:  -4.07  -5.360        0.78             0.23 2022-06-06 09:50:49.82       14        0      0 &lt;ResampleResult[22]&gt;
## 15:  -5.03  -4.951        0.78             0.21 2022-06-06 09:50:50.30       15        0      0 &lt;ResampleResult[22]&gt;
## 16:  11.63  -7.879        0.73             0.36 2022-06-06 09:50:51.21       16        0      0 &lt;ResampleResult[22]&gt;
## 17:  -2.99  -4.997        0.78             0.22 2022-06-06 09:50:51.70       17        0      0 &lt;ResampleResult[22]&gt;
## 18:  -1.47   1.324        0.73             0.21 2022-06-06 09:50:52.19       18        0      0 &lt;ResampleResult[22]&gt;
## 19:   7.24  -6.600        0.73             0.23 2022-06-06 09:50:52.79       19        0      0 &lt;ResampleResult[22]&gt;
## 20:  -6.53  -0.066        0.76             0.23 2022-06-06 09:50:53.38       20        0      0 &lt;ResampleResult[22]&gt;
## 21:  -8.13  -9.968        0.77             0.25 2022-06-06 09:50:53.98       21        0      0 &lt;ResampleResult[22]&gt;
## 22:  11.66   1.357        0.67             0.24 2022-06-06 09:50:55.52       22        0      0 &lt;ResampleResult[22]&gt;
## 23:  -0.93   2.028        0.70             0.22 2022-06-06 09:50:56.00       23        0      0 &lt;ResampleResult[22]&gt;
## 24:  -2.46  -9.325        0.77             0.24 2022-06-06 09:50:56.44       24        0      0 &lt;ResampleResult[22]&gt;
## 25:  -6.24 -12.283        0.77             0.26 2022-06-06 09:50:57.00       25        0      0 &lt;ResampleResult[22]&gt;
## 26:   4.17   5.500        0.63             0.29 2022-06-06 09:50:57.59       26        0      0 &lt;ResampleResult[22]&gt;
## 27:  -0.35 -11.888        0.77             0.22 2022-06-06 09:50:58.08       27        0      0 &lt;ResampleResult[22]&gt;
## 28:  -9.21  -5.628        0.78             0.23 2022-06-06 09:50:58.57       28        0      0 &lt;ResampleResult[22]&gt;
## 29:   1.38  -4.829        0.76             0.22 2022-06-06 09:50:59.05       29        0      0 &lt;ResampleResult[22]&gt;
## 30:   0.26  -4.265        0.76             0.21 2022-06-06 09:50:59.53       30        0      0 &lt;ResampleResult[22]&gt;
## 31:   4.08  -2.928        0.72             0.28 2022-06-06 09:51:00.13       31        0      0 &lt;ResampleResult[22]&gt;
## 32:   5.36   4.501        0.55             0.26 2022-06-06 09:51:00.73       32        0      0 &lt;ResampleResult[22]&gt;
## 33:   2.20   5.687        0.62             0.27 2022-06-06 09:51:01.32       33        0      0 &lt;ResampleResult[22]&gt;
## 34:   4.24  -9.984        0.78             0.23 2022-06-06 09:51:01.92       34        0      0 &lt;ResampleResult[22]&gt;
## 35:   0.22 -11.322        0.77             0.23 2022-06-06 09:51:02.41       35        0      0 &lt;ResampleResult[22]&gt;
## 36:  11.34  -2.092        0.70             0.48 2022-06-06 09:51:03.14       36        0      0 &lt;ResampleResult[22]&gt;
## 37:   0.23  -4.491        0.76             0.21 2022-06-06 09:51:03.63       37        0      0 &lt;ResampleResult[22]&gt;
## 38:  -9.97  -9.167        0.77             0.28 2022-06-06 09:51:04.23       38        0      0 &lt;ResampleResult[22]&gt;
## 39:  12.17  -5.629        0.70             1.10 2022-06-06 09:51:05.30       39        0      0 &lt;ResampleResult[22]&gt;
## 40:  -0.85 -13.660        0.77             0.23 2022-06-06 09:51:05.90       40        0      0 &lt;ResampleResult[22]&gt;
## 41:  -2.88  -1.761        0.76             0.22 2022-06-06 09:51:06.38       41        0      0 &lt;ResampleResult[22]&gt;
## 42:  -1.43  -7.010        0.78             0.23 2022-06-06 09:51:06.84       42        0      0 &lt;ResampleResult[22]&gt;
## 43:   8.01  -2.289        0.72             0.32 2022-06-06 09:51:07.39       43        0      0 &lt;ResampleResult[22]&gt;
## 44:  -6.84   3.615        0.65             0.27 2022-06-06 09:51:07.98       44        0      0 &lt;ResampleResult[22]&gt;
## 45:  -6.89   0.920        0.73             0.24 2022-06-06 09:51:08.58       45        0      0 &lt;ResampleResult[22]&gt;
## 46:   2.79  -0.053        0.73             0.23 2022-06-06 09:51:09.06       46        0      0 &lt;ResampleResult[22]&gt;
## 47:  13.04  -9.052        0.73             0.40 2022-06-06 09:51:09.65       47        0      0 &lt;ResampleResult[22]&gt;
## 48:  10.69  -8.323        0.74             0.29 2022-06-06 09:51:10.21       48        0      0 &lt;ResampleResult[22]&gt;
## 49:  -6.10  -4.147        0.77             0.23 2022-06-06 09:51:10.66       49        0      0 &lt;ResampleResult[22]&gt;
## 50:   2.00  -3.182        0.73             0.23 2022-06-06 09:51:11.12       50        0      0 &lt;ResampleResult[22]&gt;
##          C   sigma classif.auc runtime_learners              timestamp batch_nr warnings errors      resample_result</code></pre>
<pre class="r"><code>at_ksvm_spcv$tuning_result$learner_param_vals</code></pre>
<pre><code>## [[1]]
## [[1]]$kernel
## [1] &quot;rbfdot&quot;
## 
## [[1]]$type
## [1] &quot;C-svc&quot;
## 
## [[1]]$C
## [1] 18.91702
## 
## [[1]]$sigma
## [1] 0.000987619</code></pre>
<pre class="r"><code>at_ksvm_spcv$model$tuning_instance$archive$benchmark_result$resample_results$resample_result[[1]]</code></pre>
<pre><code>## &lt;ResampleResult&gt; of 5 iterations
## * Task: lsl
## * Learner: classif.ksvm
## * Warnings: 0 in 0 iterations
## * Errors: 0 in 0 iterations</code></pre>
<pre class="r"><code>at_ksvm_spcv$model$tuning_instance$archive$benchmark_result$resample_results$resample_result[[1]]$score()</code></pre>
<pre><code>##                   task task_id                  learner   learner_id                 resampling resampling_id iteration              prediction classif.ce
## 1: &lt;TaskClassifST[51]&gt;     lsl &lt;LearnerClassifKSVM[36]&gt; classif.ksvm &lt;ResamplingSpCVCoords[20]&gt;   spcv_coords         1 &lt;PredictionClassif[20]&gt;  0.6461538
## 2: &lt;TaskClassifST[51]&gt;     lsl &lt;LearnerClassifKSVM[36]&gt; classif.ksvm &lt;ResamplingSpCVCoords[20]&gt;   spcv_coords         2 &lt;PredictionClassif[20]&gt;  0.7916667
## 3: &lt;TaskClassifST[51]&gt;     lsl &lt;LearnerClassifKSVM[36]&gt; classif.ksvm &lt;ResamplingSpCVCoords[20]&gt;   spcv_coords         3 &lt;PredictionClassif[20]&gt;  0.6321839
## 4: &lt;TaskClassifST[51]&gt;     lsl &lt;LearnerClassifKSVM[36]&gt; classif.ksvm &lt;ResamplingSpCVCoords[20]&gt;   spcv_coords         4 &lt;PredictionClassif[20]&gt;  0.6605505
## 5: &lt;TaskClassifST[51]&gt;     lsl &lt;LearnerClassifKSVM[36]&gt; classif.ksvm &lt;ResamplingSpCVCoords[20]&gt;   spcv_coords         5 &lt;PredictionClassif[20]&gt;  0.6341463</code></pre>
<pre class="r"><code>at_ksvm_spcv$model$tuning_instance$archive$benchmark_result$resample_results$resample_result[[1]]$learner</code></pre>
<pre><code>## &lt;LearnerClassifKSVM:classif.ksvm&gt;
## * Model: -
## * Parameters: kernel=rbfdot, type=C-svc, C=0.0007759, sigma=0.0006119
## * Packages: mlr3, mlr3extralearners, kernlab
## * Predict Type: prob
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: multiclass, twoclass, weights</code></pre>
<pre class="r"><code>at_ksvm_spcv$model$tuning_instance$archive$benchmark_result$resample_results$resample_result[[1]]$learners</code></pre>
<pre><code>## [[1]]
## &lt;LearnerClassifKSVM:classif.ksvm&gt;
## * Model: ksvm
## * Parameters: kernel=rbfdot, type=C-svc, C=0.0007759, sigma=0.0006119
## * Packages: mlr3, mlr3extralearners, kernlab
## * Predict Type: prob
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: multiclass, twoclass, weights
## 
## [[2]]
## &lt;LearnerClassifKSVM:classif.ksvm&gt;
## * Model: ksvm
## * Parameters: kernel=rbfdot, type=C-svc, C=0.0007759, sigma=0.0006119
## * Packages: mlr3, mlr3extralearners, kernlab
## * Predict Type: prob
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: multiclass, twoclass, weights
## 
## [[3]]
## &lt;LearnerClassifKSVM:classif.ksvm&gt;
## * Model: ksvm
## * Parameters: kernel=rbfdot, type=C-svc, C=0.0007759, sigma=0.0006119
## * Packages: mlr3, mlr3extralearners, kernlab
## * Predict Type: prob
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: multiclass, twoclass, weights
## 
## [[4]]
## &lt;LearnerClassifKSVM:classif.ksvm&gt;
## * Model: ksvm
## * Parameters: kernel=rbfdot, type=C-svc, C=0.0007759, sigma=0.0006119
## * Packages: mlr3, mlr3extralearners, kernlab
## * Predict Type: prob
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: multiclass, twoclass, weights
## 
## [[5]]
## &lt;LearnerClassifKSVM:classif.ksvm&gt;
## * Model: ksvm
## * Parameters: kernel=rbfdot, type=C-svc, C=0.0007759, sigma=0.0006119
## * Packages: mlr3, mlr3extralearners, kernlab
## * Predict Type: prob
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: multiclass, twoclass, weights</code></pre>
<pre class="r"><code>at_ksvm_spcv$model$tuning_instance$archive$benchmark_result$resample_results$resample_result[[1]]$learners[[1]]$model
at_ksvm_spcv$model$tuning_instance$archive$benchmark_result$resample_results$resample_result[[1]]$learners[[5]]$model</code></pre>
<pre><code>## Support Vector Machine object of class &quot;ksvm&quot; 
## 
## SV type: C-svc  (classification) 
##  parameter : cost C = 0.000775938162017681 
## 
## Gaussian Radial Basis kernel function. 
##  Hyperparameter : sigma =  0.000611850188548689 
## 
## Number of Support Vectors : 266 
## 
## Objective Function Value : -0.2064 
## Training error : 0.466667 
## Probability model included. 
## Support Vector Machine object of class &quot;ksvm&quot; 
## 
## SV type: C-svc  (classification) 
##  parameter : cost C = 0.000775938162017681 
## 
## Gaussian Radial Basis kernel function. 
##  Hyperparameter : sigma =  0.000611850188548689 
## 
## Number of Support Vectors : 298 
## 
## Objective Function Value : -0.2312 
## Training error : 0.482201 
## Probability model included.</code></pre>
</div>
<div id="k-folds-cv-spatial-partitioning" class="section level5 hasAnchor">
<h5 class="hasAnchor">k-folds CV Spatial Partitioning<a href="#k-folds-cv-spatial-partitioning" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>autoplot(
  object = at_ksvm_spcv$archive$benchmark_result$resamplings$resampling[[1]],
  task = task, fold_id = 1:5
)</code></pre>
<p><img src="assets/img/unnamed-chunk-23-1.png" width="3023" /></p>
</div>
<div id="k-folds-cv-random-partitioning" class="section level5 hasAnchor">
<h5 class="hasAnchor">k-folds CV Random Partitioning<a href="#k-folds-cv-random-partitioning" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>autoplot(
  object = at_ksvm_cv$archive$benchmark_result$resamplings$resampling[[1]],
  task = task, fold_id = 1:5
)</code></pre>
<p><img src="assets/img/unnamed-chunk-24-1.png" width="3023" /></p>
</div>
<div id="prediction" class="section level5 hasAnchor">
<h5 class="hasAnchor">Prediction<a href="#prediction" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div id="_preds_svm_" class="chunk section level6">
<h6 class="hasAnchor">
preds_svm<a href="#_preds_svm_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>tic()
pred_spcv = terra::predict(
  object = ta, model = at_ksvm_spcv$model$learner$state$model,
  type = &quot;probabilities&quot;, na.rm = T
)
pred_cv = terra::predict(
  object = ta, model = at_ksvm_cv$model$learner$state$model,
  type = &quot;probabilities&quot;, na.rm = T
)
toc()</code></pre>
<pre><code>## 26.457 sec elapsed</code></pre>
</div>
</div>
<div id="prediction-maps" class="section level5 hasAnchor">
<h5 class="hasAnchor">Prediction Maps<a href="#prediction-maps" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Here we display landslide susceptibility.</p>
<pre class="r"><code>tmap_pred &lt;- function(preds, hs, bbx, sv_study_mask, palette) {
  t_map &lt;- tm_shape(shp = hs, bbox = bbx) +
    tm_grid(
      col = &quot;black&quot;, n.x = 1, n.y = 1, labels.inside.frame = FALSE,
      labels.rot = c(0, 90), lines = FALSE
    ) +
    tm_raster(palette = &quot;white&quot;, legend.show = FALSE) +
    # hillshade
    tm_shape(terra::mask(x = hs, mask = sv_study_mask), bbox = bbx) +
    tm_raster(palette = gray(0:100 / 100), n = 100, legend.show = FALSE) +
    # add prediction raster
    tm_shape(terra::mask(x = preds, mask = sv_study_mask)) +
    tm_raster(
      alpha = 0.5, palette = palette, n = 6, legend.show = TRUE, title = &quot;Susceptibility&quot;
    ) +
    tm_layout(
      legend.position = c(&quot;left&quot;, &quot;bottom&quot;), legend.title.size = 0.9, inner.margins = 0
    )
  return(t_map)
} </code></pre>
<div id="_maps-svm_" class="chunk section level6">
<h6 class="hasAnchor">
maps-svm<a href="#_maps-svm_" class="anchor-section" aria-label="Anchor link to header"></a>
</h6>
<pre class="r"><code>map_svm_spcv &lt;- tmap_pred(
  preds = pred_spcv[[1]], hs = hs, bbx = bbx, sv_study_mask = sv_study_mask, palette = &quot;Reds&quot;
)
map_svm_cv &lt;- tmap_pred(
  preds = pred_cv[[1]], hs = hs, bbx = bbx, sv_study_mask = sv_study_mask, palette = &quot;Reds&quot;
)</code></pre>
</div>
<pre class="r"><code>tmap_arrange(map, map_glm, map_svm_spcv, map_svm_cv)</code></pre>
<p><img src="assets/img/unnamed-chunk-26-1.png" width="3023" /></p>
</div>
<div id="prediction-data" class="section level5 hasAnchor">
<h5 class="hasAnchor">Prediction Data<a href="#prediction-data" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="r"><code>plot(ta)</code></pre>
<p><img src="assets/img/unnamed-chunk-27-1.png" width="3023" /></p>
</div>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5,h6",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
